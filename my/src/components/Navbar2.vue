<template>
  <div id="nav-box">
    <a id="logout" @click.prevent="logout">Log Out</a>
    <div class="rounded-box">
      <h1 id="title" class="heading">
        Delta
        <span style="font-weight: 300">Hacks</span>
        VI
      </h1>
      <h1 id="name" class="heading">
        {{ first }}
        <span style="font-weight: 300; padding-left: 7%;">{{ last }}</span>
      </h1>
    </div>
  </div>
</template>

<script lang="ts">
import firebase from 'firebase';
import Vue from 'vue';
import db from '../firebase_init';

export default Vue.extend({
  name: 'Navbar2',
  components: {},
  data() {
    return {
      c_user: firebase.auth().currentUser,
      dhs: ['DH VI', 'DH V', 'DH IV', 'DH III', 'DH II'],
      current: 'DH VI',
      drawer: null,
      items: [
        { title: 'Home', icon: 'dashboard' },
        { title: 'About', icon: 'question_answer' },
      ],
      first: 'Welcome',
      last: '',
    };
  },
  methods: {
    tst() {
      console.log('FUUUUUUUUUUUCK');
    },
    async logout() {
      console.log('logging out');
      try {
        await firebase.auth().signOut();
        console.log('Logout successful');
        this.$router.push({ name: 'Login' });
      } catch (e) {
        console.log('Logout unsuccessful');
        console.log(e);
      }
    },
  },
  async beforeMount() {
    // console.log('mounted');
    const appEmail = firebase.auth().currentUser!.email as string;
    // const genderStatus = await this.checkGenderInput(appEmail);
    try {
      db.collection('users')
        .doc(appEmail)
        .onSnapshot(snap => {
          if (snap.exists) {
            this.first = snap.data()!.first ? snap.data()!.first : 'Welcome';
            this.last = snap.data()!.first ? snap.data()!.last : '';
          }
        });
    } catch (err) {
      console.error(err);
    }
  },
});
</script>
<style scoped src='../assets/css/navbar.css'>
</style>
